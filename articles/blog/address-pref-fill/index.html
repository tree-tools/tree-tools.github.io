<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>都道府県が記載されてない住所に都道府県を追加するツール | GASで作業をもっとラクに</title>
  <meta name="description" content="GASと郵便番号APIで、都道府県のない住所を自動補完。初心者の実体験ベースの実用ツール事例を紹介します。">
  <meta property="og:title" content="住所に都道府県を自動補完するGASツール" />
  <meta property="og:description" content="GASと郵便番号APIを使って、都道府県のない住所を自動で補完。初心者の実体験ベースで紹介します。" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://example.com/articles/auto-update-timestamp/" />
  <!-- <meta property="og:image" content="https://example.com/assets/images/ogp/address-pref-fill.png" /> -->

  <!-- 広告コードはここに挿入 -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6247585947417000"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/assets/css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-javascript.min.js"></script>
  <script src="/assets/js/copy-code.js"></script>
</head>

<body>
  <!-- ヘッダー読込 -->
  <div data-include="/includes/header.html"></div>

  <main>
    <nav class="breadcrumb" aria-label="パンくずリスト">
      <ol>
        <li><a href="/">トップ</a></li>
        <li><a href="/articles/blog/">記事一覧</a></li>
        <li>記事</li>
      </ol>
    </nav>

    <article class="article-content">

      <h1 class="page-title">都道府県が記載されてない住所に都道府県を追加するツール</h1>

      <div class="article-meta">
        <span class="date">投稿日：2025-07-17</span> |
        <span class="category">カテゴリ：技術</span> |
        <span class="tags">
          <span>GAS</span>
          <span>業務効率化</span>
        </span>
      </div>

      <section class="section summary">
        <p>申込者リストなどにありがちな「都道府県の抜けた住所」を、郵便番号から自動補完するGASツールを作ってみた記録です。郵便局APIを使った住所取得処理や、つまずいた点など、実体験に基づいた内容をまとめました。</p>
      </section>

      <section class="section intro">
        <p>
          このブログは、Google Apps Script（GAS）を使った自作ツールの記録や、開発の過程での気づきをまとめたものです。<br>
          丁寧な解説というより、<strong>「こんなこともGASでできるんだ」</strong>というアイディアのきっかけになれば幸いです。
        </p>
      </section>

      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6247585947417000" data-ad-slot="9719436679"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>

      <nav class="section toc">
        <h2>目次</h2>
        <ul>
          <li><a href="#purpose">やりたかったこと</a></li>
          <li><a href="#logic">使ったロジック・ポイント</a></li>
          <li><a href="#code">コード例</a></li>
          <li><a href="#memo">メモ・反省・次回やりたいこと</a></li>
          <li><a href="#links">関連リンク</a></li>
        </ul>
      </nav>

      <section id="purpose" class="section">
        <h2>やりたかったこと</h2>
        <p>
          業務で使う申込者リストの中に、都道府県の記載がない住所がちらほら。郵便番号は書いてあるので届くことは届くのですが、一覧で見るとわかりにくいし、データとしても統一感がなく不便でした。<br>
          そこで、<strong>郵便番号から都道府県を自動で補完するGASツール</strong>を作ることにしました。
        </p>
      </section>

      <section id="logic" class="section">
        <h2>使ったロジック・ポイント</h2>
        <p>
          GASと郵便局のAPIを使って、都道府県補完の自動処理を行いました。大まかな流れは次の通りです。
        </p>

        <h3>① 郵便番号から都道府県を取得</h3>
        <ul>
          <li>郵便局が提供するZIPコードAPIを使用</li>
          <li>返ってくる住所から都道府県だけを抽出</li>
          <li>住所欄の先頭に追加</li>
        </ul>

        <h3>② 都道府県がすでに記載されているかのチェック</h3>
        <ul>
          <li>正規表現で「◯◯県」「◯◯府」「東京都」「北海道」などが先頭にあるか判定</li>
          <li>ある場合はスキップ</li>
        </ul>

        <h3>③ スプレッドシートへの書き戻し</h3>
        <ul>
          <li>スクリプトで行をループ</li>
          <li>都道府県を付け加えた新しい住所を上書き</li>
        </ul>
      </section>

      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6247585947417000" data-ad-slot="9719436679"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>

      <section id="code" class="section">
        <h2>コード例</h2>

        <p>実際に使用したGASコードの簡易版です。A列に郵便番号、B列に住所が入っている前提です。</p>

        <div class="code-container">
          <button class="copy-btn">Copy</button>
          <pre><code class="language-javascript">
function addPrefectureToAddress() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const data = sheet.getDataRange().getValues();

  for (let i = 1; i < data.length; i++) {
    const zip = data[i][0];
    const address = data[i][1];

    if (address.match(/^(東京都|北海道|大阪府|京都府|.{2,3}県)/)) continue;

    const res = UrlFetchApp.fetch("https://zipcloud.ibsnet.co.jp/api/search?zipcode=" + zip);
    const json = JSON.parse(res.getContentText());

    if (json.results && json.results.length > 0) {
      const prefecture = json.results[0].address1;
      sheet.getRange(i + 1, 2).setValue(prefecture + address);
    }
  }
}
          </code></pre>
        </div>
      </section>

      <section id="memo" class="section">
        <h2>メモ・反省・次回やりたいこと</h2>
        <p>
          都道府県の判定ロジックはかなりざっくりなので、県名の誤記や略称があると見落とします。<br>
          また、郵便番号の桁数が不正でもエラー処理がなく落ちるので、<strong>事前チェックやエラーハンドリング</strong>を入れるべきだと感じました。<br>
          今後は、<strong>郵便番号と住所が一致しているか確認するチェック機能</strong>や、<strong>未記載住所の抽出機能</strong>も加えていきたいと思っています。
        </p>
      </section>

      <section id="links" class="section">
        <h2>関連リンク</h2>
        <ul>
          <li><a href="https://zipcloud.ibsnet.co.jp/doc/api" target="_blank" rel="noopener">郵便番号API（zipcloud）</a></li>
          <li><a href="/articles/blog/index.html">自作GASツール一覧</a></li>
        </ul>
      </section>

      <p class="back-link">
        <a href="/articles/blog/index.html">← 記事一覧に戻る</a>
      </p>

      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6247585947417000" data-ad-slot="9719436679"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>

    </article>
  </main>

  <div data-include="/includes/footer.html"></div>

  <script src="/assets/js/includes.js"></script>
  <script src="/assets/js/common.js"></script>

</body>

</html>
<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GASでスプレッドシートから請求書PDFを自動作成し各ドライブへ保存するツール | GASで作業をもっとラクに</title>
  <meta name="description" content="Googleスプレッドシートのデータから請求書PDFを一括作成し、顧客ごとのGoogleドライブに自動保存するGAS活用事例を紹介します。" />
  <meta property="og:title" content="GASでスプレッドシートから請求書PDFを自動作成する方法" />
  <meta property="og:description" content="GASを使ってGoogleスプレッドシートから請求書PDFを一括作成し、顧客ごとのドライブに自動保存する方法を解説します。" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://tree-tools-gas-guide.pages.dev/articles/blog/invoice-pdf-tool/" />
  <meta property="og:image" content="https://tree-tools-gas-guide.pages.dev/assets/images/tree-toos-icon.png">

  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="canonical" href="https://tree-tools-gas-guide.pages.dev/articles/blog/invoice-pdf-tool/" />

  <!-- 共通JS -->
  <script src="/assets/js/includes.js"></script>
  <script src="/assets/js/common.js"></script>
  <!-- Prism.js コード用 -->
  <script src="/assets/js/copy-code.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-javascript.min.js"></script>
  <!-- favicon -->
  <link rel="icon" href="https://tree-tools-gas-guide.pages.dev/assets/images/tree-toos-icon.png" type="image/x-icon">

</head>

<body>
  <!-- ヘッダー読込 -->
  <div data-include="/includes/header.html"></div>

  <main>
    <nav class="breadcrumb" aria-label="パンくずリスト">
      <ol>
        <li><a href="/">トップ</a></li>
        <li><a href="/articles/blog">記事一覧</a></li>
        <li>記事</li>
      </ol>
    </nav>

    <article class="article-content">
      <h1 class="page-title">GASでスプレッドシートから請求書PDFを自動作成し各ドライブへ保存するツール</h1>

      <div class="article-meta">
        <span class="date">投稿日：2025-07-01</span> |
        <span class="category">カテゴリ：技術</span> |
        <span class="tags">
          <span>GAS</span>
          <span>ツール</span>
          <span>業務効率化</span>
          <span>スプレッドシート</span>
          <span>PDF</span>
        </span>
      </div>

      <section class="section summary">
        <p>
          数百件単位で発生する請求書作成をGASで自動化し、作業効率化とヒューマンエラーの削減を実現した事例です。
        </p>
        <p>
          このブログは、Google Apps Script（GAS）を使った自作ツールの記録や、開発の過程での気づきをまとめたものです。<br>
          丁寧な解説というより、<strong>「こんなこともGASでできるんだ」</strong>というアイディアのきっかけになれば幸いです。
        </p>
      </section>

      <!-- admax -->
      <script src="https://adm.shinobi.jp/o/98662ea3644e9850702d9a74c27b535b"></script>
      <!-- admax -->

      <nav class="section toc">
        <h2>目次</h2>
        <ul>
          <li><a href="#purpose">やりたかったこと</a></li>
          <li><a href="#logic">使ったロジック・ポイント</a></li>
          <li><a href="#code">コード例</a></li>
          <li><a href="#memo">メモ・反省・次回やりたいこと</a></li>
          <li><a href="#links">関連リンク</a></li>
        </ul>
      </nav>

      <section id="purpose" class="section">
        <h2>やりたかったこと</h2>
        <p>数百件単位で発生する請求書作成を効率化したと考えました。<br>
          従来はPDF出力後のファイル名修正や保存先の振り分けを手作業で行っており、手間もミスも多かったです。<br>
          そのため、スプレッドシートのデータをもとに、一括で請求書PDFを作り、顧客ごとのドライブフォルダに自動保存する仕組みを作りたいと思いました。</p>
      </section>

      <section id="logic" class="section">
        <h2>使ったロジック・ポイント</h2>

        <p>
          今回の請求書自動作成ツールでは、GASの複数の機能を組み合わせて以下の流れを実現しています。<br>
          処理のポイントを、目的ごとに分けて紹介します。
        </p>

        <h3>① PDF化処理の自動化</h3>
        <ul class="list-area">
          <li>
            <strong>UrlFetchApp</strong> を使って、スプレッドシートを PDF としてエクスポート
          </li>
          <li>
            出力時のサイズ・余白・向きなどを <strong>URLパラメータ</strong> で細かく調整し、レイアウト崩れを防止
          </li>
          <li>
            PDFファイルの作成処理は関数 <code>CreatePdf()</code> として分離し、他の用途にも再利用可能に設計
          </li>
        </ul>

        <h3>② フォルダへの自動保存</h3>
        <ul class="list-area">
          <li>
            顧客ごとに Drive フォルダの ID をスプレッドシートで管理し、保存先を動的に変更
          </li>
          <li>
            PDF ファイル名も動的に設定し、あとから見返しやすく整理された状態で保存
          </li>
        </ul>

        <h3>③ 実行管理とエラー対策</h3>
        <ul class="list-area">
          <li>
            <strong>完了フラグ</strong>をスプレッドシートに記録することで、処理済みの行を管理
          </li>
          <li>
            処理間に <code>Utilities.sleep()</code> を入れて、API の呼び出し制限エラーを回避
          </li>
          <li>
            GAS の <strong>6分制限</strong>に対応するため、処理時間を意識して一括実行ではなく、行ごとにループ処理を実装
          </li>
        </ul>
      </section>

      <!-- admax -->
      <script src="https://adm.shinobi.jp/o/98662ea3644e9850702d9a74c27b535b"></script>
      <!-- admax -->

      <section id="code" class="section">
        <h2>コード例</h2>

        <p>以下は、スプレッドシートのデータから請求書PDFを作成し、指定のDriveフォルダに保存するメイン処理とCreatePdf関数の例です。</p>

        <h3>メイン処理</h3>
        <div class="code-container">
          <button class="copy-btn">Copy</button>
          <pre><code class="language-javascript">function exportInvoiceAsPDF() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const sheet = ss.getSheetByName("請求データ");
  const lastRow = sheet.getLastRow();

  for (let i = 2; i <= lastRow; i++) {
    const row = sheet.getRange(i, 1, 1, 5).getValues()[0];
    const id = row[0];
    const folderId = row[4]; // 保存先フォルダID

    const templateSheet = ss.getSheetByName("請求書テンプレート");
    templateSheet.getRange("B2").setValue(row[1]); // 顧客名など転記

    const fileUrl = CreatePdf(
      DriveApp.getFolderById(folderId),
      ss.getId(),
      templateSheet.getSheetId(),
      `${id}_請求書`
    );

    sheet.getRange(i, 6).setValue("完了");
    sheet.getRange(i, 7).setValue(fileUrl);
    Utilities.sleep(500); // API制限対策
  }
}</code></pre>
        </div>

        <h3>CreatePdf 関数</h3>
        <div class="code-container">
          <button class="copy-btn">Copy</button>
          <pre><code class="language-javascript">function CreatePdf(folder, ssId, shId, fileName){
  var baseUrl = "https://docs.google.com/spreadsheets/d/"
    + ssId
    + "/export?gid="
    + shId;
  var options = "&exportFormat=pdf&format=pdf"
    + "&size=A4"
    + "&portrait=true"
    + "&scale=4"
    + "&fitw=true"
    + "&top_margin=0"
    + "&right_margin=0"
    + "&bottom_margin=0"
    + "&left_margin=0"
    + "&horizontal_alignment=CENTER"
    + "&vertical_alignment=TOP"
    + "&printtitle=false"
    + "&sheetnames=false"
    + "&gridlines=false"
    + "&fzr=false"
    + "&fzc=false";
  var url = baseUrl + options;
  var token = ScriptApp.getOAuthToken();
  var fetchOptions = {
    headers: { 'Authorization': 'Bearer ' +  token }
  };
  var blob = UrlFetchApp.fetch(url, fetchOptions).getBlob().setName(fileName + '.pdf');
  var pdf = folder.createFile(blob);
  return pdf.getUrl();
}</code></pre>
        </div>

        <h3>CreatePdf 関数の解説</h3>
        <p>CreatePdf 関数は独自に作成した関数です。<br>
          Googleスプレッドシートの特定のシートをPDF化し、Googleドライブ内の指定フォルダに保存する処理を行う関数です。</p>
        <ul class="list-area">
          <li><strong>folder</strong> … 保存先のDrive Folderオブジェクト</li>
          <li><strong>ssId</strong> … PDF化するスプレッドシートのID</li>
          <li><strong>shId</strong> … PDF化するシートのID</li>
          <li><strong>fileName</strong> … PDFファイル名</li>
        </ul>
        <p>
          ポイントは、PDF出力の細かい設定（余白・用紙向き・グリッド線表示の有無など）をURLパラメータで制御できる点です。<br>
          今回の請求書作成以外でもPDFを作成する機会が多いと考え、関数を独立させました。<br>
          実際に多くの場面でこの関数を使うので、とても重宝しています。
        </p>
      </section>

      <section id="memo" class="section">
        <h2>メモ・反省・次回やりたいこと</h2>
        <p>GASの実行時間制限（6分）があるため、件数が多いときは処理を分割して実行時間を管理しています。<br>
          また、API制限エラーを避けるために、Utilities.sleep() を挟んでいます。<br>
          PDF化後にファイル名を自動生成して保存することで、手作業でのファイル名修正が不要になりました。<br>
          将来的にはHTMLテンプレートを使ってレイアウトをもっと自由にしたり、複数ページ対応も検討したいです。</p>
      </section>

      <p class="back-link">
        <a href="/articles/blog/index.html">← 記事一覧に戻る</a>
      </p>

      <!-- admax -->
      <script src="https://adm.shinobi.jp/o/98662ea3644e9850702d9a74c27b535b"></script>
      <!-- admax -->

      <section class="section">
        <p>
          <a href="/">トップページへ戻る</a>
        </p>
      </section>

    </article>
  </main>

  <!-- フッター読み込み -->
  <div data-include="/includes/footer.html"></div>

</body>

</html>